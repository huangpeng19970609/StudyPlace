### 一、寻路

> 参考文章： http://hcysun.me/2017/03/03/Vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/
>
> 参考代码： https://github.com/vuejs/vue
>
> <span style='color: red;'>看庞大的代码应先关注于宏观</span>

### 1 寻找Vue构造函数

1.  检出 官方的vue项目， 使用 `npm run dev`命令

   此处是由关于 roll的打包过程, 了解即可，最终目标是发现vue的构造函数在哪里

   ````json
   "dev": "rollup -w -c scripts/config.js --environment TARGET:web-full-dev",
   ````

   查询对应文件的对应目标如下

   ![](images/vue-1.png)

````js
if (process.env.TARGET) {
  module.exports = genConfig(builds[process.env.TARGET])
} else {
  exports.getBuild = name => genConfig(builds[name])
  exports.getAllBuilds = () => Object.keys(builds).map(name => genConfig(builds[name]))
}

// 此处等价于
module.exports = genConfig({
 	entry: resolve('web/entry-runtime-with-compiler.js'),
    dest: resolve('dist/vue.js'),
    format: 'umd',
    env: 'development',
    alias: { he: './entity-decoder' },
    banner
})
````

2. 入口文件

    ```js
    entry: path.resolve(__dirname, '../src/entries/web-runtime-with-compiler.js'),
    ```

   在入口文件中,  故我们应看此文件， 此文件暂时略。

   第一次： 在`entry-runtime-with-compiler.js`中

   ![images/vue-2.png](images/vue-2.png)

第二次：`runtime/index` 在```中我们又可以看到如下的一句话，故

````js
import Vue from 'core/index'
````

在其`core/index`中

````js
import Vue from './instance/index'
````

在`instance/index`

<img src="images/vue-3.png" style="zoom: 80%;" />

### 2 Vue构造函数

可以看到Vue的构造函数上被添加了一些原型方法

````js
# 1	initMixin(Vue) 		
=> './init' 提供了 initMixin方法 （mixin 的含义为 混合）
	Vue.prototype._init = function (options?: Object)

#2	stateMixin(Vue) 	
=> './state' 提供了 stateMixin

	Object.defineProperty(Vue.prototype, '$data', dataDef)	 # this.$data
	Object.defineProperty(Vue.prototype, '$props', propsDef) # this.$props为谁服务？
	Vue.prototype.$set = set		# 看到了老朋友 this.$set 原来是在这里声明的！
	Vue.prototype.$delete = del
	Vue.prototype.$watch

#3
eventsMixin(Vue)	=>  './events'
	Vue.prototype.$on
	Vue.prototype.$once
	Vue.prototype.$off
	Vue.prototype.$emit # 看到了老朋友 this.$set！ 
#4
lifecycleMixin(Vue)	=> 	'./lifecycle'
	Vue.prototype._update
	Vue.prototype.$forceUpdate # 倒是见过，不过不知道具体作用 this.$forceUpdate
	Vue.prototype.$destroy
#5
renderMixin(Vue)	=>  './render'
	Vue.prototype.$nextTick
	Vue.prototype._render
	installRenderHelpers 函数在原型上挂载了好多_o, _f, _k这类方法
````





#### 

